import{_ as f,r as o,o as d,c as h,a,w as c,b as n,n as y,F as v,d as k,e as B,p as C,f as A}from"./index-CxotANaZ.js";const S=[{name:"Gravissimo",bpm:10},{name:"Grave",bpm:20},{name:"Larghissimo",bpm:30},{name:"Largo",bpm:40},{name:"Larghetto",bpm:50},{name:"Adagio",bpm:60},{name:"Adagietto",bpm:70},{name:"Andante",bpm:80},{name:"Andantino",bpm:90},{name:"Moderato",bpm:100},{name:"Allegretto",bpm:110},{name:"Allegro moderato",bpm:120},{name:"Allegro ma non troppo",bpm:130},{name:"Allegro",bpm:140},{name:"Vivace",bpm:150},{name:"Vivacissimo",bpm:160},{name:"Alegricissimo",bpm:170},{name:"Presto",bpm:180},{name:"Presto vivace",bpm:190},{name:"Prestissimo",bpm:200}],x={name:"metronome",computed:{baseUrl(){return"/"},darkTheme(){return this.$vuetify.theme.current.dark},inputDevices(){return this.$store.state.inputDevices},outputDevices(){return this.$store.state.outputDevices},tempos(){return S},bpm:{get(){return this.$store.state.metronomeBPM},set(e){this.$store.dispatch("setMetronomeBPM",e)}},bpmStep:{get(){return this.$store.state.metronomeBPMStep},set(e){this.$store.dispatch("setMetronomeBPMStep",e)}}},data(){return{audioCtx:new AudioContext,audio:new Audio,destination:null,envelope:null,tick:null,playing:!1,rhythm:1,index:0,playing:null,tic:null,toc:null,buttons:[]}},created(){this.buttons=[{strokes:1,icon:`${this.baseUrl}img/note-seminima`},{strokes:2,icon:`${this.baseUrl}img/note-colcheia`},{strokes:3,icon:`${this.baseUrl}img/note-tercina`},{strokes:4,icon:`${this.baseUrl}img/note-semi-colcheia`}]},mounted(){window.addEventListener("keydown",this.toggleByKeyboard)},beforeDestroy(){this.playing!==null&&(this.audio.pause(),this.audioCtx.close()),window.removeEventListener("keydown",this.toggleByKeyboard)},methods:{toggleByKeyboard(e){if(document.hidden)return!1;(e.code=="Digit1"||e.code=="Numpad1")&&this.toggle(1,0),(e.code=="Digit2"||e.code=="Numpad2")&&this.toggle(2,1),(e.code=="Digit3"||e.code=="Numpad3")&&this.toggle(3,2),(e.code=="Digit4"||e.code=="Numpad4")&&this.toggle(4,3),["ArrowLeft","MediaTrackPrevious","-"].includes(e.key)&&this.subtractBpm(),["ArrowRight","MediaTrackNext","+"].includes(e.key)&&this.addBpm(),[" ","MediaPlayPause"].includes(e.key)&&(this.toggle(this.rhythm,this.index),e.preventDefault())},toggle(e,t,m=!1){if(this.playing!==null&&(this.audio.pause(),this.audioCtx.close()),m&&this.playing==null)return!1;if(!m&&this.playing==t)return this.audio.pause(),this.playing=null;this.rhythm=e,this.index=t,this.playing=t,document.documentElement.style.setProperty("--tempo",`${12e4/this.bpm}ms`),this.createAudioCtx()},createAudioCtx(){this.audioCtx=new AudioContext,this.destination=this.audioCtx.createMediaStreamDestination(),this.envelope=this.audioCtx.createGain(),this.envelope.connect(this.destination),this.audio.srcObject=this.destination.stream,this.$store.state.defaultOutputId&&this.outputDevices.find(e=>e.deviceId==this.$store.state.defaultOutputId)&&this.audio.setSinkId(this.$store.state.defaultOutputId),this.createTicks()},createTicks(){this.tick=this.audioCtx.createOscillator(),this.tick.type="sine",this.tick.connect(this.envelope);let e=this.audioCtx.currentTime;for(let t=0;t<1e3;t++)this.tick.frequency.setValueAtTime(this.getSound(t%this.rhythm),e),this.envelope.gain.setValueAtTime(0,e),this.envelope.gain.linearRampToValueAtTime(0,e+.001+.01),this.envelope.gain.linearRampToValueAtTime(1,e+.001),e+=60/(this.bpm*this.rhythm);this.audio.play(),this.tick.start(),this.tick.stop(e+.001+.01),this.tick.onended=()=>{this.playing=null}},getSound(e,t=!1){return this.rhythm<=1?1500:this.rhythm%2==0?e%2==0?1500:1e3:e==0?1500:1e3},subtractBpm(){if(this.$refs.subtractBpmButton.$el.blur(),this.bpm<=this.bpmStep)return!1;this.bpm-=this.bpmStep,this.playing!==null&&this.toggle(this.rhythm,this.index,!0)},addBpm(){if(this.$refs.addBpmButton.$el.blur(),this.bpm>=200)return!1;this.bpm+=this.bpmStep,this.playing!==null&&this.toggle(this.rhythm,this.index,!0)}}},_=e=>(C("data-v-6b9967f4"),e=e(),A(),e),V=_(()=>n("figure",null,null,-1)),w=["src"];function T(e,t,m,D,l,i){const p=o("v-select"),b=o("v-slider"),r=o("v-btn"),g=o("v-main");return d(),h("main",null,[a(g,null,{default:c(()=>[n("section",null,[V,n("mark",{class:y({animating:l.playing!==null})},null,2)]),n("section",null,[n("header",null,[a(p,{modelValue:i.bpm,"onUpdate:modelValue":t[0]||(t[0]=s=>i.bpm=s),items:i.tempos,"item-title":"name","item-value":"bpm",label:e.$t("metronome.tempo")},null,8,["modelValue","items","label"]),a(b,{modelValue:i.bpm,"onUpdate:modelValue":t[1]||(t[1]=s=>i.bpm=s),step:"10",max:"200","thumb-label":"always",color:"primary",onChange:t[2]||(t[2]=s=>i.toggle(l.rhythm,l.index,!0))},null,8,["modelValue"])]),n("nav",null,[(d(!0),h(v,null,k(l.buttons,(s,u)=>(d(),B(r,{key:u,onClick:M=>i.toggle(s.strokes,u),color:l.playing==u?"primary":null,class:"elevation-4",title:e.$t("home.play")},{default:c(()=>[n("img",{src:`${s.icon}${i.darkTheme?"-dark":"-light"}.svg`},null,8,w)]),_:2},1032,["onClick","color","title"]))),128))]),n("footer",null,[a(r,{onClick:i.subtractBpm,ref:"subtractBpmButton",icon:"remove",size:"small",title:e.$t("metronome.subtractStep",{n:i.bpmStep})},null,8,["onClick","title"]),a(p,{variant:"underlined",modelValue:i.bpmStep,"onUpdate:modelValue":t[3]||(t[3]=s=>i.bpmStep=s),items:i.tempos,"item-title":"bpm","item-value":"bpm"},null,8,["modelValue","items"]),a(r,{fab:"",small:"",onClick:i.addBpm,ref:"addBpmButton",icon:"add",size:"small",title:e.$t("metronome.addStep",{n:i.bpmStep})},null,8,["onClick","title"])])])]),_:1})])}const $=f(x,[["render",T],["__scopeId","data-v-6b9967f4"]]);export{$ as default};
